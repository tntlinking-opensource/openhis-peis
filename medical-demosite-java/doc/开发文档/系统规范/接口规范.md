## 沃德健管平台接口规范

### 一、接口路径定义格式

接口的风格采用restful接口风格，查询`@GetMapping("")`，提交`@PostMapping("")`，修改`@PutMapping("")`，删除`@DeleteMapping("")`
。接口的路径统一规范为：模块名/controller名/函数名。

- class级Mapping：@RequestMapping("模块名/controller名")，如：`@RequestMapping("member/interflow")`
- function级Mapping：/函数名, 如：`@GetMapping("/page")`
- 样例

```java

@Slf4j
@RestController
@RequiredArgsConstructor
@Api(tags = "会员管理-生日关怀")
@RequestMapping("member/birthday")
public class MemberbirthdatController extends BaseController {
    /**
     * 分页查询所有数据
     *
     * @param pageParamSimple 分页参数
     * @param param           查询条件
     * @return 所有数据
     */
    @GetMapping("/page")
    //@PreAuthorize("@ss.hasPermi('::list')")
    @ApiOperation(value = "分页查询", notes = "分页查询会员生日提醒回访列表数据")
    public R<IPage<MemberbirthdatVo>> getPage(PageParamSimple pageParamSimple, MemberbirthdayParam param) {
        PageParam<Memberbirthdat> page = mapperFacade.map(pageParamSimple, PageParam.class);
        return R.ok(this.memberbirthdatService.getPage(page, param));
    }
}
```

### 二、统一返回值数据格式

**1. 状态码，见：``HttpStatus``**

``
请求返回值格式：{code：'状态码:[操作成功=200, 对象创建成功=201, " +
"请求已经被接受=202, 操作已经执行成功，但是没有返回数据=204, 资源已被移除=301, 重定向=303, 资源没有被修改=304, " +
"参数列表错误（缺少，格式不匹配）=400, 未授权=401, 访问受限，授权过期=403, 资源，服务未找到=404, 不允许的http方法=405" +
"资源冲突，或者资源被锁=409, 不支持的数据，媒体类型=415, 系统内部错误=500, 接口未实现=501]，" +
"详情见：HttpStatus', msg: '返回内容', data: 数据对象''}
``

**2. 返回格式，见：`R`**

**3. 调用方式， 如：controller.com.center.medical.data.PaPeissortexamController**

**4. 参数接收定义：请求参数如果包含`开始时间:startTime`、`结束时间:endTime`、`分中心id:branchId/cid/fxz`这三个参数， 参数接收类直接继承基础参数接收类:`BaseParam`**

```java
/**
 * @author: 路飞
 * @date: 2022-10-14 13:47
 * @description: 基础请求参数
 */
public class BaseParam implements Serializable {
    private static final long serialVersionUID = 5421021060821948357L;

    @ApiModelProperty(value = "分中心id")
    private String branchId;

    @DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    @ApiModelProperty(value = "开始时间")
    private Date startTime;

    @DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    @ApiModelProperty(value = "结束时间")
    private Date endTime;

}
```

```java
/**
 * @author: 路飞
 * @date: 2022-11-08 15:00
 * @description:
 */
@Data
public class PaPeiEParam extends BaseParam {

}
```

### 三、统一异常处理

在开发过程中，不可避免的是需要处理各种异常，异常处理方法随处可见，所以代码中就会出现大量的`try {...} catch {...} finally {...}`
代码块，不仅会造成大量的冗余代码，而且还影响代码的可读性，所以对异常统一处理非常有必要。为此，我们定义了一个统一的异常类`ServiceException`
**1. 代码**

```java
package com.center.medical.common.exception;

/**
 * 业务异常
 *
 * @author 路飞
 */
public final class ServiceException extends RuntimeException {
    private static final long serialVersionUID = 1L;

    /**
     * 错误码
     */
    private Integer code;

    /**
     * 错误提示
     */
    private String message;

    /**
     * 错误明细，内部调试错误
     * <p>
     * 和 {@link CommonResult#getDetailMessage()} 一致的设计
     */
    private String detailMessage;

    /**
     * 空构造方法，避免反序列化问题
     */
    public ServiceException() {
    }

    public ServiceException(String message) {
        this.message = message;
    }

    public ServiceException(String message, Integer code) {
        this.message = message;
        this.code = code;
    }

    public String getDetailMessage() {
        return detailMessage;
    }

    @Override
    public String getMessage() {
        return message;
    }

    public Integer getCode() {
        return code;
    }

    public ServiceException setMessage(String message) {
        this.message = message;
        return this;
    }

    public ServiceException setDetailMessage(String detailMessage) {
        this.detailMessage = detailMessage;
        return this;
    }
}
```

**2. 调用方式**

```java
throw new ServiceException("获取用户账户异常",HttpStatus.UNAUTHORIZED);
```

