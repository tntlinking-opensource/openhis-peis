<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.center.medical.app.dao.BsSettlementMapper">

    <resultMap type="com.center.medical.app.bean.model.BsSettlement" id="BsSettlementMap">
        <id property="settlementId" column="settlement_id"/>
        <result property="payNo" column="pay_no"/>
        <result property="bizPayNo" column="biz_pay_no"/>
        <result property="orderId" column="order_id"/>
        <result property="bizOrderNo" column="biz_order_no"/>
        <result property="payType" column="pay_type"/>
        <result property="payTypeName" column="pay_type_name"/>
        <result property="payScore" column="pay_score"/>
        <result property="payAmount" column="pay_amount"/>
        <result property="isClearing" column="is_clearing"/>
        <result property="userId" column="user_id"/>
        <result property="createTime" column="create_time"/>
        <result property="clearingTime" column="clearing_time"/>
        <result property="callbackTime" column="callback_time"/>
        <result property="version" column="version"/>
        <result property="payStatus" column="pay_status"/>
        <result property="changeAmountVersion" column="change_amount_version"/>
        <result property="orderOrigin" column="order_origin"/>
        <result property="fzxId" column="fzx_id"/>
    </resultMap>

    <!-- 数据表字段属性 -->
    <sql id="selectBsSettlementVo">
        select settlement_id,
               pay_no,
               biz_pay_no,
               order_id,
               biz_order_no,
               pay_type,
               pay_type_name,
               pay_score,
               pay_amount,
               is_clearing,
               user_id,
               create_time,
               clearing_time,
               callback_time,
               version,
               pay_status,
               change_amount_version,
               order_origin,
               fzx_id
        from md_bs_settlement
    </sql>

    <!-- 查询列表数据 -->
    <select id="getPage" resultMap="BsSettlementMap">
        <include refid="selectBsSettlementVo"/>
    </select>

    <!-- 根据主键id获取记录详情 -->
    <select id="getInfoById" resultMap="BsSettlementMap">
        <include refid="selectBsSettlementVo"/>
        <where>
            settlement_id = #{id}
        </where>
    </select>


    <update id="updateToPay">
        update md_bs_settlement
        set pay_status    = 1,
            version       = version + 1,
            biz_pay_no    = #{bizPayNo},
            callback_time = now()
        where pay_no = #{payNo}
          and version = #{version}
    </update>
</mapper>

