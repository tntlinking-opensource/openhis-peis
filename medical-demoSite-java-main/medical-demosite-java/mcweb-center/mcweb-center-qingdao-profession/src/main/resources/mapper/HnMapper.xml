<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.center.medical.center.qingdao.profession.mapper.HnMapper">




    <!-- 根据主键id获取记录详情 -->
    <select id="getOhEmployees" resultType="com.center.medical.center.qingdao.profession.entity.dto.GetOhEmployeesDto">
        SELECT
            p.patientcode,
            p.inpatientno,
            cs.license_name AS empOrgName,
            cs.social_credit_code AS empOrgBizCode,
            p.dateregister AS peDate,
            ( CASE WHEN p.id_examtype = 3 THEN '1' ELSE '0' END ) AS peFlag,
            p.patientname,
            ( CASE WHEN p.id_sex = 0 THEN '1' ELSE '2' END ) AS sexCode,
            ( CASE p.countreportoccupationxml WHEN 1 THEN '01' WHEN 2 THEN '03' WHEN 6 THEN '04' WHEN 7 THEN '06' ELSE "03" END ) AS idType,
            p.idcardno AS idcard,
            p.phone AS empPhone,
            p.birthdate AS birthday,
            p.age,
            p.jhys,
            bw.qingdao_code AS typeOfWorkCode,
            ( CASE WHEN cs.rau_khdwmc IS NOT NULL THEN cs.rau_khdwmc ELSE cs.license_name END ) AS employerEnterpriseName,
            ( CASE WHEN cs.rau_social_credit_code IS NOT NULL THEN cs.rau_social_credit_code ELSE cs.social_credit_code END ) AS employerCreditCode,
            r.generate_date as preparerDate
        FROM
            md_peispatient p
                LEFT JOIN crm_sellcustomer cs ON cs.id = p.id_org
                LEFT JOIN md_base_worktype bw ON bw.id = p.worktype_id
                left join md_report r on r.patientcode = p.patientcode
                and r.disease_health = 1
        WHERE
            p.patientcode = #{patientCode}

    </select>
</mapper>

