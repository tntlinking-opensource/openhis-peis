<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.center.medical.report.dao.QuestionnaireMapper">

    <resultMap type="com.center.medical.bean.model.Questionnaire" id="QuestionnaireMap">
        <id property="id" column="id"/>
        <result property="createdate" column="createdate"/>
        <result property="modifydate" column="modifydate"/>
        <result property="patientcode" column="patientcode"/>
        <result property="patientname" column="patientname"/>
        <result property="idSex" column="id_sex"/>
        <result property="birthdate" column="birthdate"/>
        <result property="idcardno" column="idcardno"/>
        <result property="isHan" column="is_han"/>
        <result property="idMarriage" column="id_marriage"/>
        <result property="phone" column="phone"/>
        <result property="cultural" column="cultural"/>
        <result property="career" column="career"/>
        <result property="homeAddress" column="home_address"/>
        <result property="workAddress" column="work_address"/>
        <result property="creator" column="creator"/>
        <result property="question1" column="question1"/>
        <result property="question2" column="question2"/>
        <result property="question3" column="question3"/>
        <result property="question4" column="question4"/>
        <result property="question5" column="question5"/>
        <result property="question6" column="question6"/>
        <result property="question7" column="question7"/>
        <result property="question8" column="question8"/>
        <result property="question9" column="question9"/>
        <result property="question10" column="question10"/>
        <result property="question11" column="question11"/>
        <result property="question12" column="question12"/>
        <result property="question13" column="question13"/>
        <result property="question14" column="question14"/>
        <result property="question15" column="question15"/>
        <result property="question16" column="question16"/>
        <result property="question17" column="question17"/>
        <result property="question18" column="question18"/>
        <result property="question19" column="question19"/>
        <result property="question20" column="question20"/>
        <result property="question21" column="question21"/>
        <result property="question22" column="question22"/>
        <result property="question23" column="question23"/>
        <result property="question24" column="question24"/>
        <result property="question25" column="question25"/>
        <result property="question26" column="question26"/>
        <result property="question27" column="question27"/>
        <result property="question28" column="question28"/>
        <result property="question29" column="question29"/>
        <result property="question30" column="question30"/>
        <result property="liveHours" column="live_hours"/>
        <result property="workingHours" column="working_hours"/>
        <result property="fzxid" column="fzxid"/>
        <result property="pic" column="pic"/>
        <result property="countreportoccupationxml" column="countreportoccupationxml"/>
        <result property="type" column="type"/>
    </resultMap>

    <!-- 数据表字段属性 -->
    <sql id="selectQuestionnaireVo">
        select id,
               createdate,
               modifydate,
               patientcode,
               patientname,
               id_sex,
               birthdate,
               idcardno,
               is_han,
               id_marriage,
               phone,
               cultural,
               career,
               home_address,
               work_address,
               creator,
               question1,
               question2,
               question3,
               question4,
               question5,
               question6,
               question7,
               question8,
               question9,
               question10,
               question11,
               question12,
               question13,
               question14,
               question15,
               question16,
               question17,
               question18,
               question19,
               question20,
               question21,
               question22,
               question23,
               question24,
               question25,
               question26,
               question27,
               question28,
               question29,
               question30,
               live_hours,
               working_hours,
               fzxid,
               pic,
               countreportoccupationxml,
               type
        from md_questionnaire
    </sql>

    <!-- 查询列表数据 -->
    <select id="getPage" resultMap="QuestionnaireMap">
        <include refid="selectQuestionnaireVo"/>
    </select>

    <!-- 根据主键id获取记录详情 -->
    <select id="getInfoById" resultMap="QuestionnaireMap">
        <include refid="selectQuestionnaireVo"/>
        <where>
            id = #{id}
        </where>
    </select>


    <!-- 根据主键id获取记录详情 -->
    <select id="getAppSatisfactionLevel" resultType="com.center.medical.member.bean.vo.AppSatisfactionLevelVo">
        SELECT
            que.id,
            p.patientcode,
            p.patientname,
            p.phone,
            p.f_usecodehiden,
            p.hospitalcode as fzxId,
            b.fzx,
            que.question1,
            que.question2,
            que.question3,
            que.question4,
            que.question5,
            que.question6,
            que.question7,
            que.question8,
            que.question9,
            que.question10,
            que.question11,
            que.question12
        FROM
            md_questionnaire que
                LEFT JOIN md_peispatient p ON p.short_code = que.patientcode
                LEFT JOIN sys_branch b ON b.branch_id = p.hospitalcode
        <where>
            que.type = 1
            <if test="param.patientcode!=null and param.patientcode!=''">
                AND p.patientcode like concat('%',#{param.patientcode},'%')
            </if>
            <if test="param.patientname!=null and param.patientname!=''">
                AND p.patientname like concat('%',#{param.patientname},'%')
            </if>
            <if test="param.phone!=null and param.phone!=''">
                AND p.phone like concat('%',#{param.phone},'%')
            </if>
            <if test="param.fUsecodehiden!=null">
                AND p.f_usecodehiden = #{param.fUsecodehiden}
            </if>
            <if test="param.fzxId!=null and param.fzxId!=''">
                AND p.hospitalcode = #{param.fzxId}
            </if>
            <if test="param.question1!=null and param.question1!=''">
                AND que.question1 = #{param.question1}
            </if>
            <if test="param.question2!=null and param.question2!=''">
                AND que.question2 = #{param.question2}
            </if>
            <if test="param.question3!=null and param.question3!=''">
                AND que.question3 = #{param.question3}
            </if>
            <if test="param.question4!=null and param.question4!=''">
                AND que.question4 = #{param.question4}
            </if>
            <if test="param.question5!=null and param.question5!=''">
                AND que.question5 = #{param.question5}
            </if>
            <if test="param.question6!=null and param.question6!=''">
                AND que.question6 = #{param.question6}
            </if>
            <if test="param.startTime!=null">
                AND que.createdate <![CDATA[ >= ]]> #{param.startTime}
            </if>
            <if test="param.endTime!=null">
                AND que.createdate <![CDATA[ <= ]]> #{param.endTime}
            </if>
            <if test="param.registrationStartTime!=null">
                AND p.dateregister <![CDATA[ >= ]]> #{param.registrationStartTime}
            </if>
            <if test="param.registrationEndTime!=null">
                ANDp.dateregister <![CDATA[ <= ]]> #{param.registrationEndTime}
            </if>
        </where>
        order by que.createdate desc
    </select>



    <!-- 获取导出数据 -->
    <select id="getExportData" resultType="com.center.medical.member.bean.vo.AppSatisfactionLevelVo">
        SELECT
        que.id,
        p.patientcode,
        p.patientname,
        p.phone,
        p.f_usecodehiden,
        p.hospitalcode as fzxId,
        b.fzx,
        que.question1,
        que.question2,
        que.question3,
        que.question4,
        que.question5,
        que.question6,
        que.question7,
        que.question8,
        que.question9,
        que.question10,
        que.question11,
        que.question12
        FROM
        md_questionnaire que
        LEFT JOIN md_peispatient p ON p.short_code = que.patientcode
        LEFT JOIN sys_branch b ON b.branch_id = p.hospitalcode
        <where>
            que.type = 1
            <if test="param.patientcode!=null and param.patientcode!=''">
                AND p.patientcode like concat('%',#{param.patientcode},'%')
            </if>
            <if test="param.patientname!=null and param.patientname!=''">
                AND p.patientname like concat('%',#{param.patientname},'%')
            </if>
            <if test="param.phone!=null and param.phone!=''">
                AND p.phone like concat('%',#{param.phone},'%')
            </if>
            <if test="param.fUsecodehiden!=null">
                AND p.f_usecodehiden = #{param.fUsecodehiden}
            </if>
            <if test="param.fzxId!=null and param.fzxId!=''">
                AND p.hospitalcode = #{param.fzxId}
            </if>
            <if test="param.question1!=null and param.question1!=''">
                AND que.question1 = #{param.question1}
            </if>
            <if test="param.question2!=null and param.question2!=''">
                AND que.question2 = #{param.question2}
            </if>
            <if test="param.question3!=null and param.question3!=''">
                AND que.question3 = #{param.question3}
            </if>
            <if test="param.question4!=null and param.question4!=''">
                AND que.question4 = #{param.question4}
            </if>
            <if test="param.question5!=null and param.question5!=''">
                AND que.question5 = #{param.question5}
            </if>
            <if test="param.question6!=null and param.question6!=''">
                AND que.question6 = #{param.question6}
            </if>
            <if test="param.startTime!=null">
                AND que.createdate <![CDATA[ >= ]]> #{param.startTime}
            </if>
            <if test="param.endTime!=null">
                AND que.createdate <![CDATA[ <= ]]> #{param.endTime}
            </if>
            <if test="param.registrationStartTime!=null">
                AND p.dateregister <![CDATA[ >= ]]> #{param.registrationStartTime}
            </if>
            <if test="param.registrationEndTime!=null">
                AND p.dateregister <![CDATA[ <= ]]> #{param.registrationEndTime}
            </if>
        </where>
        order by que.createdate desc
    </select>
</mapper>

