<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.center.medical.pacslis.dao.PacsPeispatientMapper">

    <resultMap type="com.center.medical.pacslis.bean.model.PacsPeispatient" id="PacsPeispatientMap">
        <id property="id" column="id"/>
        <result property="idPatient" column="id_patient"/>
        <result property="idOrgpatient" column="id_orgpatient"/>
        <result property="idCis" column="id_cis"/>
        <result property="patientarchiveno" column="patientarchiveno"/>
        <result property="patientcode" column="patientcode"/>
        <result property="patientcodeprn" column="patientcodeprn"/>
        <result property="patientarchiveno" column="patientarchiveno"/>
        <result property="patientcardno" column="patientcardno"/>
        <result property="patientbizno" column="patientbizno"/>
        <result property="idcardno" column="idcardno"/>
        <result property="dailynumberdate" column="dailynumberdate"/>
        <result property="dailynumber" column="dailynumber"/>
        <result property="numtotal" column="numtotal"/>
        <result property="numyear" column="numyear"/>
        <result property="nummonth" column="nummonth"/>
        <result property="numday" column="numday"/>
        <result property="numorg" column="numorg"/>
        <result property="numorgresv" column="numorgresv"/>
        <result property="idPatientlinked" column="id_patientlinked"/>
        <result property="idNonorg" column="id_nonorg"/>
        <result property="patientname" column="patientname"/>
        <result property="inputCode" column="input_code"/>
        <result property="idOrgreservationgroup" column="id_orgreservationgroup"/>
        <result property="idOrgreservation" column="id_orgreservation"/>
        <result property="idOrg" column="id_org"/>
        <result property="orgName" column="org_name"/>
        <result property="orgDepart" column="org_depart"/>
        <result property="orgDepartsuba" column="org_departsuba"/>
        <result property="orgDepartsubb" column="org_departsubb"/>
        <result property="orgDepartsubc" column="org_departsubc"/>
        <result property="orgDepartsubd" column="org_departsubd"/>
        <result property="orgDepartsube" column="org_departsube"/>
        <result property="havePrivate" column="have_private"/>
        <result property="idPayway" column="id_payway"/>
        <result property="payway" column="payway"/>
        <result property="offpercent" column="offpercent"/>
        <result property="maxoffpercent" column="maxoffpercent"/>
        <result property="personpricelimit" column="personpricelimit"/>
        <result property="idSex" column="id_sex"/>
        <result property="sex" column="sex"/>
        <result property="birthdate" column="birthdate"/>
        <result property="age" column="age"/>
        <result property="idAgeunit" column="id_ageunit"/>
        <result property="ageunit" column="ageunit"/>
        <result property="ageofreal" column="ageofreal"/>
        <result property="idMarriage" column="id_marriage"/>
        <result property="marriage" column="marriage"/>
        <result property="idNation" column="id_nation"/>
        <result property="nation" column="nation"/>
        <result property="address" column="address"/>
        <result property="idInformway" column="id_informway"/>
        <result property="idOpendoctor" column="id_opendoctor"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="idPatientclass" column="id_patientclass"/>
        <result property="idEducation" column="id_education"/>
        <result property="education" column="education"/>
        <result property="idOccupation" column="id_occupation"/>
        <result property="occupation" column="occupation"/>
        <result property="idResarea" column="id_resarea"/>
        <result property="resarea" column="resarea"/>
        <result property="dateinorganization" column="dateinorganization"/>
        <result property="fIsforprepare" column="f_isforprepare"/>
        <result property="fIsforreserve" column="f_isforreserve"/>
        <result property="datecreated" column="datecreated"/>
        <result property="fRegistered" column="f_registered"/>
        <result property="dateregister" column="dateregister"/>
        <result property="positionCode" column="position_code"/>
        <result property="jobtypeCode" column="jobtype_code"/>
        <result property="moneyamount" column="moneyamount"/>
        <result property="moneyamountpaid" column="moneyamountpaid"/>
        <result property="guidancenote" column="guidancenote"/>
        <result property="workno" column="workno"/>
        <result property="idDoctorreg" column="id_doctorreg"/>
        <result property="doctorreg" column="doctorreg"/>
        <result property="idExamtype" column="id_examtype"/>
        <result property="idExamsuite" column="id_examsuite"/>
        <result property="examsuiteName" column="examsuite_name"/>
        <result property="examsuiteAlias" column="examsuite_alias"/>
        <result property="idDoctorconclusion" column="id_doctorconclusion"/>
        <result property="doctorconclusion" column="doctorconclusion"/>
        <result property="idDoctorapply" column="id_doctorapply"/>
        <result property="doctorapply" column="doctorapply"/>
        <result property="fGuidanceprinted" column="f_guidanceprinted"/>
        <result property="fFeecharged" column="f_feecharged"/>
        <result property="fExamstarted" column="f_examstarted"/>
        <result property="fReadytofinal" column="f_readytofinal"/>
        <result property="idDoctorfee" column="id_doctorfee"/>
        <result property="doctorfee" column="doctorfee"/>
        <result property="fPaused" column="f_paused"/>
        <result property="fFinallocked" column="f_finallocked"/>
        <result property="fFinalexamed" column="f_finalexamed"/>
        <result property="fFinalapproved" column="f_finalapproved"/>
        <result property="idDoctorfinal" column="id_doctorfinal"/>
        <result property="doctorfinalNameR" column="doctorfinal_name_r"/>
        <result property="datefinalexamed" column="datefinalexamed"/>
        <result property="idDoctorfinalapproved" column="id_doctorfinalapproved"/>
        <result property="datefinalapproved" column="datefinalapproved"/>
        <result property="fCardissued" column="f_cardissued"/>
        <result property="fCardreturned" column="f_cardreturned"/>
        <result property="fCoverprinted" column="f_coverprinted"/>
        <result property="fReportprinted" column="f_reportprinted"/>
        <result property="idReportprintedby" column="id_reportprintedby"/>
        <result property="datereportprinted" column="datereportprinted"/>
        <result property="fReportinformed" column="f_reportinformed"/>
        <result property="datereportinformed" column="datereportinformed"/>
        <result property="fReportfetched" column="f_reportfetched"/>
        <result property="datereportfetched" column="datereportfetched"/>
        <result property="fIssevere" column="f_issevere"/>
        <result property="fClosed" column="f_closed"/>
        <result property="dateclosed" column="dateclosed"/>
        <result property="fNeedtraced" column="f_needtraced"/>
        <result property="fDiffperson" column="f_diffperson"/>
        <result property="confidentiallevel" column="confidentiallevel"/>
        <result property="fSettleall" column="f_settleall"/>
        <result property="signature" column="signature"/>
        <result property="note" column="note"/>
        <result property="dtLastmodifiedthisat" column="dt_lastmodifiedthisat"/>
        <result property="fInneroper" column="f_inneroper"/>
        <result property="severedegree" column="severedegree"/>
        <result property="severedegreenote" column="severedegreenote"/>
        <result property="fSevereinformed" column="f_severeinformed"/>
        <result property="severeinformtime" column="severeinformtime"/>
        <result property="idSevereinformby" column="id_severeinformby"/>
        <result property="conclusion" column="conclusion"/>
        <result property="conclusionsummary" column="conclusionsummary"/>
        <result property="suggestion" column="suggestion"/>
        <result property="conclusionrich" column="conclusionrich"/>
        <result property="dietguide" column="dietguide"/>
        <result property="sportguide" column="sportguide"/>
        <result property="knowledge" column="knowledge"/>
        <result property="message" column="message"/>
        <result property="positivesummary" column="positivesummary"/>
        <result property="resultcompare" column="resultcompare"/>
        <result property="interfacemarks" column="interfacemarks"/>
        <result property="patientflag" column="patientflag"/>
        <result property="timingstartedat" column="timingstartedat"/>
        <result property="timeresultlastchange" column="timeresultlastchange"/>
        <result property="timeresultlastarchive" column="timeresultlastarchive"/>
        <result property="timeresultlastolap" column="timeresultlastolap"/>
        <result property="hospitalcode" column="hospitalcode"/>
        <result property="hospitalname" column="hospitalname"/>
        <result property="idExamplace" column="id_examplace"/>
        <result property="parsedassignedsuiteandfi" column="parsedassignedsuiteandfi"/>
        <result property="parsedassignedgroupandfi" column="parsedassignedgroupandfi"/>
        <result property="parsedsuiteandfi" column="parsedsuiteandfi"/>
        <result property="parsedsuiteandfilab" column="parsedsuiteandfilab"/>
        <result property="idGuidenurse" column="id_guidenurse"/>
        <result property="patientnameencoded" column="patientnameencoded"/>
        <result property="patientcodehiden" column="patientcodehiden"/>
        <result property="fPdfcreated" column="f_pdfcreated"/>
        <result property="fWordcreated" column="f_wordcreated"/>
        <result property="fWordprinted" column="f_wordprinted"/>
        <result property="guidancenote2" column="guidancenote2"/>
        <result property="fUsecodehiden" column="f_usecodehiden"/>
        <result property="idPatientclass2" column="id_patientclass2"/>
        <result property="idPatientclass3" column="id_patientclass3"/>
        <result property="dateregisternotime" column="dateregisternotime"/>
        <result property="counterreportprinted" column="counterreportprinted"/>
        <result property="fPrintcomparingreport" column="f_printcomparingreport"/>
        <result property="fIsrecheck" column="f_isrecheck"/>
        <result property="fSettlenone" column="f_settlenone"/>
        <result property="fGuidancereturned" column="f_guidancereturned"/>
        <result property="dateguidancereturned" column="dateguidancereturned"/>
        <result property="idGuidancereturnedby" column="id_guidancereturnedby"/>
        <result property="fOutpatient" column="f_outpatient"/>
        <result property="patientnamereceipt" column="patientnamereceipt"/>
        <result property="patientnamepinyin" column="patientnamepinyin"/>
        <result property="fForpreparefinancialconfirm" column="f_forpreparefinancialconfirm"/>
        <result property="statusofhm" column="statusofhm"/>
        <result property="instancetag" column="instancetag"/>
        <result property="keybirthplace" column="keybirthplace"/>
        <result property="keybloodtype" column="keybloodtype"/>
        <result property="exammethod" column="exammethod"/>
        <result property="inpatientno" column="inpatientno"/>
        <result property="insuranceno" column="insuranceno"/>
        <result property="keypayway" column="keypayway"/>
        <result property="healthcard" column="healthcard"/>
        <result property="exampoint" column="exampoint"/>
        <result property="fingerprint" column="fingerprint"/>
        <result property="countreportcoverprinted" column="countreportcoverprinted"/>
        <result property="countreportprinted" column="countreportprinted"/>
        <result property="countreportpdf" column="countreportpdf"/>
        <result property="countreportword" column="countreportword"/>
        <result property="countreportxml" column="countreportxml"/>
        <result property="countreportcompare" column="countreportcompare"/>
        <result property="countreportcomparepdf" column="countreportcomparepdf"/>
        <result property="countreportcompareword" column="countreportcompareword"/>
        <result property="countreportcomparexml" column="countreportcomparexml"/>
        <result property="countreportoccupation" column="countreportoccupation"/>
        <result property="countreportoccupationpdf" column="countreportoccupationpdf"/>
        <result property="countreportoccupationword" column="countreportoccupationword"/>
        <result property="countreportoccupationxml" column="countreportoccupationxml"/>
        <result property="scbs" column="scbs"/>
        <result property="idTjtc" column="id_tjtc"/>
        <result property="jzdw" column="jzdw"/>
        <result property="jzdwr" column="jzdwr"/>
        <result property="spr" column="spr"/>
        <result property="tjr" column="tjr"/>
        <result property="lqfs" column="lqfs"/>
        <result property="yzbm" column="yzbm"/>
        <result property="yjaddress" column="yjaddress"/>
        <result property="qtxz" column="qtxz"/>
        <result property="isHmdb" column="is_hmdb"/>
        <result property="isHmd" column="is_hmd"/>
        <result property="isjj" column="isjj"/>
        <result property="zgl" column="zgl"/>
        <result property="jhgl" column="jhgl"/>
        <result property="jhys" column="jhys"/>
        <result property="jktjzt" column="jktjzt"/>
        <result property="zytjzt" column="zytjzt"/>
        <result property="tmyd" column="tmyd"/>
        <result property="medicaldate" column="medicaldate"/>
        <result property="trades" column="trades"/>
        <result property="cjjgsfyhf" column="cjjgsfyhf"/>
        <result property="bhgybsfyhf" column="bhgybsfyhf"/>
        <result property="yxjgsfyhf" column="yxjgsfyhf"/>
        <result property="medicaltype" column="medicaltype"/>
        <result property="prepayment" column="prepayment"/>
        <result property="tcprice" column="tcprice"/>
        <result property="createdate" column="createdate"/>
        <result property="modifydate" column="modifydate"/>
        <result property="cultural" column="cultural"/>
        <result property="everOfDisease" column="ever_of_disease"/>
        <result property="ccnl" column="ccnl"/>
        <result property="jq" column="jq"/>
        <result property="zq" column="zq"/>
        <result property="tjnl" column="tjnl"/>
        <result property="familyNumber" column="family_number"/>
        <result property="zc" column="zc"/>
        <result property="sc" column="sc"/>
        <result property="lc" column="lc"/>
        <result property="jt" column="jt"/>
        <result property="ywrc" column="ywrc"/>
        <result property="abstainSmokeNote" column="abstain_smoke_note"/>
        <result property="everydaySmokeN" column="everyday_smoke_n"/>
        <result property="smokeYear" column="smoke_year"/>
        <result property="noKissTheCup" column="no_kiss_the_cup"/>
        <result property="betweenKissTheCup" column="between_kiss_the_cup"/>
        <result property="evermoreKiss" column="evermore_kiss"/>
        <result property="abstainLostKiss" column="abstain_lost_kiss"/>
        <result property="kissYearN" column="kiss_year_n"/>
        <result property="kissAmount" column="kiss_amount"/>
        <result property="kissType" column="kiss_type"/>
        <result property="familyOfDisease" column="family_of_disease"/>
        <result property="symptom" column="symptom"/>
        <result property="isAudit" column="is_audit"/>
        <result property="everOfDiseaseRemark" column="ever_of_disease_remark"/>
        <result property="createReportNum" column="create_report_num"/>
        <result property="workDate" column="work_date"/>
        <result property="harmDate" column="harm_date"/>
        <result property="picture" column="picture"/>
        <result property="advice" column="advice"/>
        <result property="diseasePrintNum" column="disease_print_num"/>
        <result property="healthPrintNum" column="health_print_num"/>
        <result property="readytofinalDate" column="readytofinal_date"/>
        <result property="guideSignleCount" column="guide_signle_count"/>
        <result property="shortCode" column="short_code"/>
        <result property="isNoticed" column="is_noticed"/>
        <result property="reviewPdf" column="review_pdf"/>
        <result property="contraindicatedPdf" column="contraindicated_pdf"/>
        <result property="diseasePdf" column="disease_pdf"/>
        <result property="signPicture" column="sign_picture"/>
    </resultMap>

    <!-- 数据表字段属性 -->
    <sql id="selectPacsPeispatientVo">
        select id,
               id_patient,
               id_orgpatient,
               id_cis,
               patientarchiveno,
               patientcode,
               patientcodeprn,
               patientarchiveno,
               patientcardno,
               patientbizno,
               idcardno,
               dailynumberdate,
               dailynumber,
               numtotal,
               numyear,
               nummonth,
               numday,
               numorg,
               numorgresv,
               id_patientlinked,
               id_nonorg,
               patientname,
               input_code,
               id_orgreservationgroup,
               id_orgreservation,
               id_org,
               org_name,
               org_depart,
               org_departsuba,
               org_departsubb,
               org_departsubc,
               org_departsubd,
               org_departsube,
               have_private,
               id_payway,
               payway,
               offpercent,
               maxoffpercent,
               personpricelimit,
               id_sex,
               sex,
               birthdate,
               age,
               id_ageunit,
               ageunit,
               ageofreal,
               id_marriage,
               marriage,
               id_nation,
               nation,
               address,
               id_informway,
               id_opendoctor,
               email,
               phone,
               id_patientclass,
               id_education,
               education,
               id_occupation,
               occupation,
               id_resarea,
               resarea,
               dateinorganization,
               f_isforprepare,
               f_isforreserve,
               datecreated,
               f_registered,
               dateregister,
               position_code,
               jobtype_code,
               moneyamount,
               moneyamountpaid,
               guidancenote,
               workno,
               id_doctorreg,
               doctorreg,
               id_examtype,
               id_examsuite,
               examsuite_name,
               examsuite_alias,
               id_doctorconclusion,
               doctorconclusion,
               id_doctorapply,
               doctorapply,
               f_guidanceprinted,
               f_feecharged,
               f_examstarted,
               f_readytofinal,
               id_doctorfee,
               doctorfee,
               f_paused,
               f_finallocked,
               f_finalexamed,
               f_finalapproved,
               id_doctorfinal,
               doctorfinal_name_r,
               datefinalexamed,
               id_doctorfinalapproved,
               datefinalapproved,
               f_cardissued,
               f_cardreturned,
               f_coverprinted,
               f_reportprinted,
               id_reportprintedby,
               datereportprinted,
               f_reportinformed,
               datereportinformed,
               f_reportfetched,
               datereportfetched,
               f_issevere,
               f_closed,
               dateclosed,
               f_needtraced,
               f_diffperson,
               confidentiallevel,
               f_settleall,
               signature,
               note,
               dt_lastmodifiedthisat,
               f_inneroper,
               severedegree,
               severedegreenote,
               f_severeinformed,
               severeinformtime,
               id_severeinformby,
               conclusion,
               conclusionsummary,
               suggestion,
               conclusionrich,
               dietguide,
               sportguide,
               knowledge,
               message,
               positivesummary,
               resultcompare,
               interfacemarks,
               patientflag,
               timingstartedat,
               timeresultlastchange,
               timeresultlastarchive,
               timeresultlastolap,
               hospitalcode,
               hospitalname,
               id_examplace,
               parsedassignedsuiteandfi,
               parsedassignedgroupandfi,
               parsedsuiteandfi,
               parsedsuiteandfilab,
               id_guidenurse,
               patientnameencoded,
               patientcodehiden,
               f_pdfcreated,
               f_wordcreated,
               f_wordprinted,
               guidancenote2,
               f_usecodehiden,
               id_patientclass2,
               id_patientclass3,
               dateregisternotime,
               counterreportprinted,
               f_printcomparingreport,
               f_isrecheck,
               f_settlenone,
               f_guidancereturned,
               dateguidancereturned,
               id_guidancereturnedby,
               f_outpatient,
               patientnamereceipt,
               patientnamepinyin,
               f_forpreparefinancialconfirm,
               statusofhm,
               instancetag,
               keybirthplace,
               keybloodtype,
               exammethod,
               inpatientno,
               insuranceno,
               keypayway,
               healthcard,
               exampoint,
               fingerprint,
               countreportcoverprinted,
               countreportprinted,
               countreportpdf,
               countreportword,
               countreportxml,
               countreportcompare,
               countreportcomparepdf,
               countreportcompareword,
               countreportcomparexml,
               countreportoccupation,
               countreportoccupationpdf,
               countreportoccupationword,
               countreportoccupationxml,
               scbs,
               id_tjtc,
               jzdw,
               jzdwr,
               spr,
               tjr,
               lqfs,
               yzbm,
               yjaddress,
               qtxz,
               is_hmdb,
               is_hmd,
               isjj,
               zgl,
               jhgl,
               jhys,
               jktjzt,
               zytjzt,
               tmyd,
               medicaldate,
               trades,
               cjjgsfyhf,
               bhgybsfyhf,
               yxjgsfyhf,
               medicaltype,
               prepayment,
               tcprice,
               createdate,
               modifydate,
               cultural,
               ever_of_disease,
               ccnl,
               jq,
               zq,
               tjnl,
               family_number,
               zc,
               sc,
               lc,
               jt,
               ywrc,
               abstain_smoke_note,
               everyday_smoke_n,
               smoke_year,
               no_kiss_the_cup,
               between_kiss_the_cup,
               evermore_kiss,
               abstain_lost_kiss,
               kiss_year_n,
               kiss_amount,
               kiss_type,
               family_of_disease,
               symptom,
               is_audit,
               ever_of_disease_remark,
               create_report_num,
               work_date,
               harm_date,
               picture,
               advice,
               disease_print_num,
               health_print_num,
               readytofinal_date,
               guide_signle_count,
               short_code,
               is_noticed,
               review_pdf,
               contraindicated_pdf,
               disease_pdf,
               sign_picture
        from md_pacs_peispatient
    </sql>

    <!-- 查询列表数据 -->
    <select id="getPage" resultType="com.center.medical.pacslis.bean.model.PacsPeispatient">
        SELECT
        p.id,
        p.patientcode,
        p.patientname,
        p.id_sex,
        p.age,
        p.birthdate,
        p.org_name,
        p.id_examtype,
        p.id_patientclass,
        p.id_tjtc as idExamsuite,
        p.examsuite_name,
        p.numorgresv,
        p.id_payway,
        p.id_orgreservationgroup,
        p.medicaldate,
        p.createdate,
        p.id_org,
        p.id_orgreservation,
        STR_TO_DATE( p.dateregister, '%Y-%m-%d %T') dateregister,
        0 as dbtype,
        p.f_closed,
        IFNULL(p.jktjzt,-1),
        IFNULL(p.zytjzt,-1),
        p.idcardno,
        p.phone,
        p.doctorapply,
        p.countreportcompare,
        p.doctorreg,
        p.patientbizno,
        p.countreportxml,
        p.tjr
        FROM
        md_pacs_peispatient p
        <where>
            1 = 1
            <if test="param.patientcode!=null and param.patientcode!=''">
                AND p.patientcode like concat('%',#{param.patientcode},'%')
            </if>
            <if test="param.inputCode!=null and param.inputCode!=''">
                AND (p.input_code LIKE concat('%',#{param.inputCode},'%')
                OR p.patientname LIKE concat('%',#{param.inputCode},'%'))
            </if>
            <if test="param.phone!=null and param.phone!=''">
                AND p.phone like concat('%',#{param.phone},'%')
            </if>
            <if test="param.idcardno!=null and param.idcardno!=''">
                AND p.idcardno like concat('%',#{param.idcardno},'%')
            </if>
            <if test="param.idExamtype!=null and param.idExamtype!=''">
                AND p.id_examtype like concat('%',#{param.idExamtype},'%')
            </if>
            <if test="param.startTime!=null">
                AND p.dateregister <![CDATA[ >= ]]> #{param.startTime}
            </if>
            <if test="param.endTime!=null">
                AND p.dateregister <![CDATA[ <= ]]> #{param.endTime}
            </if>
            <if test="param.idOrg!=null and param.idOrg!=''">
                AND p.id_org = #{param.idOrg}
            </if>
        </where>
        ORDER BY p.dateregister DESC
    </select>

    <!-- 根据主键id获取记录详情 -->
    <select id="getInfoById" resultMap="PacsPeispatientMap">
        <include refid="selectPacsPeispatientVo"/>
        <where>
            id = #{id}
        </where>
    </select>


    <!-- 查询图表数据 -->
    <select id="getChart" resultType="com.center.medical.pacslis.bean.dto.ChartDto">
        select
        p.id_examtype,
        count(*) count
        from
        md_pacs_peispatient p
        <where>
            p.f_registered = 1
            and p.id_examtype in (0,1)
            <if test="startTime!=null">
                AND p.dateregister <![CDATA[ >= ]]> #{param.startTime}
            </if>
            <if test="endTime!=null">
                AND p.dateregister <![CDATA[ <= ]]> #{param.endTime}
            </if>
        </where>
        GROUP BY p.id_examtype
    </select>


    <!-- PACS-彩超审核查看分页 -->
    <select id="getDivPage" resultType="com.center.medical.pacslis.bean.vo.DivisionVo">
        SELECT
        p.id,
        p.patientname,
        p.patientcode,
        p.id_sex,
        p.age,
        pt.patient_name as idPatientclass,
        p.id_examtype,
        p.phone,
        m.examdoctor as name,
        pt.flag,
        ps.f_diffperson,
        pi.examfeeitem_name as mc,
        m.examresultdesc as ms,
        m.examresultsummary as xj,
        p.dateregister,
        m.username
        FROM md_pacs_peispatient p
        LEFT JOIN md_peis_state ps ON ps.patientcode = p.patientcode
        LEFT JOIN md_patienttype pt ON pt.id = p.id_patientclass
        INNER JOIN md_pacs_peispatientfeeitem i ON i.id_ks = #{param.ksId}
        AND i.id_patient = p.patientcode
        AND ( i.f_giveup IS NULL OR i.f_giveup = 0 )
        AND ( i.sfjj IS NULL OR i.sfjj = 0 )
        AND ( i.change_item IS NULL OR i.change_item = 0 )
        AND i.f_transferedhl7 IS NULL
        LEFT JOIN md_pacs_result m ON m.dep_id = #{param.ksId}
        AND m.patientcode = p.patientcode
        AND i.id_examfeeitem = m.item_id
        LEFT JOIN md_pacs_items pi ON pi.id = i.id_examfeeitem
        <where>
            p.f_registered = 1
            AND i.f_examinated = 1
            <if test="param.patientcode!=null and param.patientcode!=''">
                AND p.patientcode like concat('%',#{param.patientcode},'%')
            </if>
            <if test="param.patientname!=null and param.patientname!=''">
                AND p.patientname like concat('%',#{param.patientname},'%')
            </if>
            <if test="param.startTime!=null">
                AND p.dateregister <![CDATA[ >= ]]> #{param.startTime}
            </if>
            <if test="param.endTime!=null">
                AND p.dateregister <![CDATA[ <= ]]> #{param.endTime}
            </if>
        </where>
        ORDER BY p.dateregister,p.patientcode asc
    </select>


    <!-- 取得已预约客户 -->
    <select id="getReservationUser" resultType="com.center.medical.pacslis.bean.vo.ReservationUserVo">
        SELECT
        p.id,
        p.patientcode,
        p.patientname,
        p.id_sex,
        p.age,
        p.phone,
        p.idcardno,
        p.medicaldate,
        '' creater,
        p.dateguidancereturned,
        p.org_name,
        '' notifyResult,
        '' notifyTime,
        p.is_noticed
        FROM
        md_pacs_peispatient p
        <where>
            p.f_isforreserve = 1
            <if test="param.type!=null and param.type!=''">
                <if test="type == 0">
                    AND p.patientbizno IS NULL
                </if>
                <if test="type == 1">
                    AND p.patientbizno IS NOT NULL
                </if>
            </if>
            AND (P.F_REGISTERED = 0 OR P.F_REGISTERED IS NULL )
            AND (P.F_PAUSED IS NULL OR P.F_PAUSED = 0)
            <if test="param.patientcode!=null and param.patientcode!=''">
                AND p.patientcode like concat('%',#{param.patientcode},'%')
            </if>
            <if test="param.phone!=null and param.phone!=''">
                AND p.phone like concat('%',#{param.phone},'%')
            </if>
            <if test="param.patientname!=null and param.patientname!=''">
                AND p.patientname like concat('%',#{param.patientname},'%')
            </if>
            <if test="param.idcardno!=null and param.idcardno!=''">
                AND p.idcardno like concat('%',#{param.idcardno},'%')
            </if>
        </where>
        ORDER BY p.medicaldate ASC
    </select>
</mapper>

